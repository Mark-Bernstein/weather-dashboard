<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Weather Dashboard</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <span class="navbar-brand mb-1 h1">Weather Dashboard</span>
    </nav>

    <div class="container">
        <div class="row">
            <div class="col-md-3">
                <div class="row">
                    <h2>Search for a City:</h2>
                    <input type="text" id="citySearch">
                    <button class="btn btn-success"><span class="fa fa-search"></span>Go!</button>
                    <button id="clearBtn">Clear Search History</button>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <hr>
                        <!-- <div class="list-group" id="search-list"></div> -->
                        <div class="previousSearchList"></div>
                    </div>
                </div>
            </div>

            <div class="col-md-9">
                <div class="row">
                    <div class="jumbotron">
                        <h1 id="cityName"></h1>
                        <div id="weatherIcon"></div>
                        <p id="temperature"></p>
                        <p id="humidity"></p>
                        <p id="windSpeed"></p>
                        <p id="uvIndex"></p>
                    </div>
                </div>
                <div class="row">
                    <h5 class="card-title">5-Day Forecast:</h5>
                </div>
                <div class="row">
                    <div class="card mt-2" style="width:150px;height:200px;">
                        <div class="card-body" style="color:white;background-color: rgb(55, 58, 255);">
                            <div class="forecastDate1"></div>
                            <div class="weatherIcon1"></div>
                            <div class="tempForecast1"></div>
                            <div class="humidityForecast1"></div>
                        </div>
                    </div>
                    <p>-</p>
                    <div class="card mt-2" style="width:150px;height:200px;">
                        <div class="card-body" style="color:white;background-color: rgb(55, 58, 255);">
                            <div class="forecastDate2"></div>
                            <div class="weatherIcon2"></div>
                            <div class="tempForecast2"></div>
                            <div class="humidityForecast2"></div>
                        </div>
                    </div>
                    <p>-</p>
                    <div class="card mt-2" style="width:150px;height:200px;">
                        <div class="card-body" style="color:white;background-color: rgb(55, 58, 255);">
                            <div class="forecastDate3"></div>
                            <div class="weatherIcon3"></div>
                            <div class="tempForecast3"></div>
                            <div class="humidityForecast3"></div>
                        </div>
                    </div>
                    <p>-</p>
                    <div class="card mt-2" style="width:150px;height:200px;">
                        <div class="card-body" style="color:white;background-color: rgb(55, 58, 255);">
                            <div class="forecastDate4"></div>
                            <div class="weatherIcon4"></div>
                            <div class="tempForecast4"></div>
                            <div class="humidityForecast4"></div>
                        </div>
                    </div>
                    <p>-</p>
                    <div class="card mt-2" style="width:150px;height:200px;">
                        <div class="card-body" style="color:white;background-color: rgb(55, 58, 255);">
                            <div class="forecastDate5"></div>
                            <div class="weatherIcon5"></div>
                            <div class="tempForecast5"></div>
                            <div class="humidityForecast5"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            var APIKey = "221028cb8f66254e19c65e04a9ab9b51";
            var userCitySearches = [];
            userCitySearches = localStorage.getItem("userInputStorage");
            userCitySearches = JSON.parse(userCitySearches) || [];
            renderSearchHistory()
            var userInput;

            function displayWeatherInfo(cityName) {
                var forecastQueryURL = "https://api.openweathermap.org/data/2.5/forecast?q=" +
                    cityName + "&units=imperial&APPID=" + APIKey;
                var queryURL =
                    "https://api.openweathermap.org/data/2.5/weather?q=" +
                    cityName + "&units=imperial&APPID=" + APIKey;
                //call the weather api
                $.ajax({
                    url: queryURL,
                    method: "GET"
                }).then(function (response) {
                    var cityLat = "lat=" + response.coord.lat;
                    var cityLon = "lon=" + response.coord.lon;
                    var uvIndexQueryURL =
                        "http://api.openweathermap.org/data/2.5/uvi?" +
                        "&APPID=" + APIKey + "&" + cityLat + "&" + cityLon;
                    //call the UV index api
                    $.ajax({
                        url: uvIndexQueryURL,
                        method: "GET"
                    }).then(function (UVresponse) {
                        //Generate HTML element for UV index
                        $("#uvIndex").text("UV Index: " + UVresponse.value);
                    });
                    var cityP = $("<p>").text(response.name + " (Today)");
                    //var weatherIconToday = response.weather.icon;
                    //var weatherIconImgToday = $("<img>").attr("src", "https://openweathermap.org/img/wn/" + weatherIconToday + "@2x.png");
                    var temperatureP = $("<p>").text("Temperature: " + response.main.temp + " ℉");
                    var humidityP = $("<p>").text("Humidity: " + response.main.humidity + "%");
                    var windSpeedP = $("<p>").text("Wind Speed: " + response.wind.speed + " MPH");
                    $("#cityName").empty();
                    //$(".weatherIconToday").empty();
                    $("#temperature").empty();
                    $("#humidity").empty();
                    $("#windSpeed").empty();
                    $("#uvIndex").empty();
                    $("#cityName").append(cityP);
                    //$("#cityName").append(weatherIconImgToday);
                    $("#temperature").append(temperatureP);
                    $("#humidity").append(humidityP);
                    $("#windSpeed").append(windSpeedP);
                });
                //call the 5 day forecase api
                $.ajax({
                    url: forecastQueryURL,
                    method: "GET"
                })
                    // We store all of the retrieved data inside of an object called "response"
                    .then(function (response) {
                        displayWeatherForecast(response);
                    });
            }
            
            function displayWeatherForecast(response) {
                //day 1
                var dateP1 = $("<p>").text(response.list[3].dt_txt);
                var weatherIcon1 = response.list[3].weather[0].icon;
                var weatherIconImg1 = $("<img>").attr("src", "https://openweathermap.org/img/wn/" + weatherIcon1 + "@2x.png");
                var temperatureP1 = $("<p>").text("Temp: " + response.list[3].main.temp + " ℉");
                var humidityP1 = $("<p>").text("Humidity: " + response.list[3].main.humidity + "%");
                $(".forecastDate1").empty();
                $(".weatherIcon1").empty();
                $(".tempForecast1").empty();
                $(".humidityForecast1").empty();
                $("#weatherIcon").empty();
                $(".forecastDate1").append(dateP1);
                $(".weatherIcon1").append(weatherIconImg1);
                $(".tempForecast1").append(temperatureP1);
                $(".humidityForecast1").append(humidityP1);
                $("#weatherIcon").append(weatherIconImg1);
                //day 2
                var dateP2 = $("<p>").text(response.list[11].dt_txt);
                var weatherIcon2 = response.list[11].weather[0].icon;
                var weatherIconImg2 = $("<img>").attr("src", "https://openweathermap.org/img/wn/" + weatherIcon2 + "@2x.png");
                var temperatureP2 = $("<p>").text("Temp: " + response.list[11].main.temp + " ℉");
                var humidityP2 = $("<p>").text("Humidity: " + response.list[11].main.humidity + "%");
                $(".forecastDate2").empty();
                $(".weatherIcon2").empty();
                $(".tempForecast2").empty();
                $(".humidityForecast2").empty();
                $(".forecastDate2").append(dateP2);
                $(".weatherIcon2").append(weatherIconImg2);
                $(".tempForecast2").append(temperatureP2);
                $(".humidityForecast2").append(humidityP2);
                //day 3
                var dateP3 = $("<p>").text(response.list[19].dt_txt);
                var weatherIcon3 = response.list[19].weather[0].icon;
                var weatherIconImg3 = $("<img>").attr("src", "https://openweathermap.org/img/wn/" + weatherIcon3 + "@2x.png");
                var temperatureP3 = $("<p>").text("Temp: " + response.list[19].main.temp + " ℉");
                var humidityP3 = $("<p>").text("Humidity: " + response.list[19].main.humidity + "%");
                $(".forecastDate3").empty();
                $(".weatherIcon3").empty();
                $(".tempForecast3").empty();
                $(".humidityForecast3").empty();
                $(".forecastDate3").append(dateP3);
                $(".weatherIcon3").append(weatherIconImg3);
                $(".tempForecast3").append(temperatureP3);
                $(".humidityForecast3").append(humidityP3);
                //day 4
                var dateP4 = $("<p>").text(response.list[27].dt_txt);
                var weatherIcon4 = response.list[27].weather[0].icon;
                var weatherIconImg4 = $("<img>").attr("src", "https://openweathermap.org/img/wn/" + weatherIcon4 + "@2x.png");
                var temperatureP4 = $("<p>").text("Temp: " + response.list[27].main.temp + " ℉");
                var humidityP4 = $("<p>").text("Humidity: " + response.list[27].main.humidity + "%");
                $(".forecastDate4").empty();
                $(".weatherIcon4").empty();
                $(".tempForecast4").empty();
                $(".humidityForecast4").empty();
                $(".forecastDate4").append(dateP4);
                $(".weatherIcon4").append(weatherIconImg4);
                $(".tempForecast4").append(temperatureP4);
                $(".humidityForecast4").append(humidityP4);
                //day 5
                var dateP5 = $("<p>").text(response.list[35].dt_txt);
                var weatherIcon5 = response.list[35].weather[0].icon;
                var weatherIconImg5 = $("<img>").attr("src", "https://openweathermap.org/img/wn/" + weatherIcon5 + "@2x.png");
                var temperatureP5 = $("<p>").text("Temp: " + response.list[35].main.temp + " ℉");
                var humidityP5 = $("<p>").text("Humidity: " + response.list[35].main.humidity + "%");
                $(".forecastDate5").empty();
                $(".weatherIcon5").empty();
                $(".tempForecast5").empty();
                $(".humidityForecast5").empty();
                $(".forecastDate5").append(dateP5);
                $(".weatherIcon5").append(weatherIconImg5);
                $(".tempForecast5").append(temperatureP5);
                $(".humidityForecast5").append(humidityP5);
            }

            function addPreviousSearch() {
                var newButton;
                //$(".previousSearchList").empty();
                var btnPreviousSearch = $("<button>")
                btnPreviousSearch.addClass("search list-group-item list-group-item-action");
                btnPreviousSearch.attr("data-name", userInput);
                btnPreviousSearch.text(userInput);
                $(".previousSearchList").prepend(btnPreviousSearch);
                //renderSearchHistory()
            }
            function renderSearchHistory() {
                console.log(userCitySearches);
                for (var i = 0; i < userCitySearches.length; i++) {
                    // $("#search-list").empty();
                    var button = $("<button>");
                    button.addClass("search list-group-item list-group-item-action");
                    button.text(userCitySearches[i]);
                    $(".previousSearchList").prepend(button);
                }
            }

            $(document).on("click", ".list-group-item-action", function (event) {
                event.preventDefault();
                // This line grabs the input from the textbox
                var pastSearchButton = $(this).text();
                displayWeatherInfo(pastSearchButton);
            });

            $(".btn-success").on("click", function (event) {
                event.preventDefault();
                // This line grabs the input from the textbox
                userInput = $("#citySearch").val().trim();
                if ((userInput === null) || (userInput === "")) {
                    console.log("There was no user input.");
                    return;
                } else {
                    userCitySearches.push(userInput);
                    localStorage.setItem("userInputStorage", JSON.stringify(userCitySearches));
                    displayWeatherInfo(userInput);
                    addPreviousSearch();
                }
            });
            $(document).on("click", ".search list-group-item list-group-item-action", displayWeatherInfo);
            //clears history (buttons go away!)
            $("#clearBtn").on("click", function (event) {
                localStorage.clear();
            });
        });

    </script>
</body>

</html>
